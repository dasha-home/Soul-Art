<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>–¢–≤–æ—Ä—á–µ—Å–∫–∞—è –∫–æ–º–Ω–∞—Ç–∞ ‚Äî —Ä–∏—Å–æ–≤–∞—Ç—å –∫–∏—Å—Ç—å—é –æ–Ω–ª–∞–π–Ω | –î–∞—à–∞ –•—É–¥–æ–∂–Ω–∏–∫</title>
  <meta name="description" content="–¢–≤–æ—Ä—á–µ—Å–∫–∞—è –∫–æ–º–Ω–∞—Ç–∞: —Ä–∏—Å—É–π –∫–∏—Å—Ç—å—é –Ω–∞ —Ö–æ–ª—Å—Ç–µ, –≤—ã–±–∏—Ä–∞–π —Ü–≤–µ—Ç–∞, —Å–æ—Ö—Ä–∞–Ω—è–π —Ä–∞–±–æ—Ç—ã. –û–Ω–ª–∞–π–Ω-—Ä–∏—Å–æ–≤–∞–Ω–∏–µ –Ω–∞ —Å–∞–π—Ç–µ –î–∞—à–∏ –•—É–¥–æ–∂–Ω–∏–∫." />
  <link rel="stylesheet" href="styles.css" />
  <style>
    /* ‚îÄ‚îÄ –°—Ç—Ä–∞–Ω–∏—Ü–∞ ‚îÄ‚îÄ */
    .draw-page {
      min-height: 100dvh;
      background: #0e0a06;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* ‚îÄ‚îÄ –®–∞–ø–∫–∞ ‚îÄ‚îÄ */
    .draw-header {
      position: fixed;
      top: 0; left: 0; right: 0;
      z-index: 30;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.7rem max(8.5rem, calc(env(safe-area-inset-right) + 8rem)) 0.7rem clamp(1rem, 3vw, 2rem);
      background: linear-gradient(to bottom, rgba(10, 6, 2, 0.92) 0%, transparent 100%);
    }
    .draw-header__back {
      font-size: 0.88rem;
      color: rgba(215, 178, 100, 0.75);
      text-decoration: none;
      transition: color 0.2s;
    }
    .draw-header__back:hover { color: #d8b87e; }
    .draw-header__title {
      font-size: clamp(0.9rem, 2vw, 1.1rem);
      color: rgba(235, 205, 145, 0.8);
      letter-spacing: 0.12em;
      font-family: Georgia, serif;
    }

    /* ‚îÄ‚îÄ –•–æ–ª—Å—Ç ‚îÄ‚îÄ */
    .draw-canvas-wrap {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 4rem 1rem 9rem;
      box-sizing: border-box;
    }
    #draw-canvas {
      border-radius: 4px;
      border: 1px solid rgba(185, 138, 50, 0.3);
      box-shadow: 0 0 60px rgba(0,0,0,0.8), 0 0 120px rgba(255, 140, 20, 0.06);
      cursor: crosshair;
      touch-action: none;
      display: block;
      max-width: 100%;
      max-height: calc(100dvh - 13rem);
      background: #fff;
    }
    #draw-canvas.eraser-mode { cursor: cell; }

    /* ‚îÄ‚îÄ –ü–∞–Ω–µ–ª—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ ‚îÄ‚îÄ */
    .draw-toolbar {
      position: fixed;
      bottom: max(1rem, env(safe-area-inset-bottom));
      left: 50%;
      transform: translateX(-50%);
      z-index: 30;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      flex-wrap: wrap;
      justify-content: center;
      padding: 0.6rem 1rem;
      background: rgba(12, 8, 3, 0.88);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(185, 138, 50, 0.25);
      border-radius: 40px;
      box-shadow: 0 4px 32px rgba(0,0,0,0.5);
    }

    /* –¶–≤–µ—Ç–æ–≤—ã–µ –∫—Ä—É–∂–∫–∏ */
    .draw-colors {
      display: flex;
      gap: 0.3rem;
      align-items: center;
    }
    .draw-color {
      width: 26px; height: 26px;
      border-radius: 50%;
      border: 2px solid transparent;
      cursor: pointer;
      transition: transform 0.15s, border-color 0.15s;
      flex-shrink: 0;
    }
    .draw-color:hover { transform: scale(1.2); }
    .draw-color--active { border-color: rgba(255, 220, 100, 0.9); transform: scale(1.15); }

    /* –í—ã–±–æ—Ä —Å–≤–æ–µ–≥–æ —Ü–≤–µ—Ç–∞ */
    .draw-color-custom {
      width: 26px; height: 26px;
      border-radius: 50%;
      border: 2px solid rgba(185, 138, 50, 0.5);
      cursor: pointer;
      overflow: hidden;
      padding: 0;
      background: conic-gradient(red, yellow, lime, cyan, blue, magenta, red);
      flex-shrink: 0;
    }
    .draw-color-custom input[type="color"] {
      width: 200%;
      height: 200%;
      opacity: 0;
      cursor: pointer;
      margin: -50%;
    }

    .draw-sep { width: 1px; height: 24px; background: rgba(185, 138, 50, 0.2); flex-shrink: 0; }

    /* –†–∞–∑–º–µ—Ä –∫–∏—Å—Ç–∏ */
    .draw-size {
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }
    .draw-size__label { font-size: 0.7rem; color: rgba(185, 150, 80, 0.7); white-space: nowrap; }
    .draw-size__range {
      -webkit-appearance: none;
      width: 70px; height: 4px;
      border-radius: 2px;
      background: rgba(185, 138, 50, 0.3);
      outline: none;
      cursor: pointer;
    }
    .draw-size__range::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 14px; height: 14px;
      border-radius: 50%;
      background: #d8a84a;
      cursor: pointer;
    }

    /* –ö–Ω–æ–ø–∫–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ */
    .draw-btn {
      width: 36px; height: 36px;
      border-radius: 50%;
      border: 1px solid rgba(185, 138, 50, 0.3);
      background: rgba(30, 20, 8, 0.6);
      color: rgba(215, 178, 100, 0.75);
      font-size: 1rem;
      cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      transition: background 0.2s, color 0.2s, border-color 0.2s;
      flex-shrink: 0;
    }
    .draw-btn:hover { background: rgba(60, 40, 10, 0.8); color: #d8b87e; border-color: rgba(215, 165, 55, 0.5); }
    .draw-btn--active { background: rgba(185, 138, 50, 0.3); color: #f0d070; border-color: rgba(215, 165, 55, 0.7); }
    .draw-btn--danger:hover { background: rgba(120, 30, 20, 0.5); color: #e08070; border-color: rgba(180, 60, 50, 0.5); }
    .draw-btn--save { background: rgba(40, 90, 50, 0.4); border-color: rgba(80, 160, 90, 0.4); color: rgba(140, 220, 140, 0.85); }
    .draw-btn--save:hover { background: rgba(50, 120, 60, 0.6); color: #a8eab8; border-color: rgba(100, 200, 110, 0.6); }

    /* –ü–æ–¥—Å–∫–∞–∑–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ */
    .draw-tool-hint {
      position: fixed;
      top: 4rem; left: 50%;
      transform: translateX(-50%);
      font-size: 0.75rem;
      color: rgba(215, 178, 100, 0.45);
      pointer-events: none;
      transition: opacity 0.4s;
      white-space: nowrap;
      z-index: 20;
    }

    /* ‚îÄ‚îÄ –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π —ç–∫—Ä–∞–Ω ‚îÄ‚îÄ */
    .draw-welcome {
      position: fixed;
      inset: 0;
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(6, 3, 1, 0.82);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      transition: opacity 0.4s;
    }
    .draw-welcome.hidden { opacity: 0; pointer-events: none; }
    .draw-welcome__box {
      background: rgba(20, 13, 5, 0.96);
      border: 1px solid rgba(185, 138, 50, 0.35);
      border-radius: 20px;
      padding: 2rem 2.5rem;
      max-width: 420px;
      width: 90%;
      text-align: center;
      box-shadow: 0 0 80px rgba(255, 140, 20, 0.12);
    }
    .draw-welcome__title {
      font-size: 1.4rem;
      color: rgba(235, 200, 130, 0.9);
      font-family: Georgia, serif;
      margin: 0 0 1.2rem;
      letter-spacing: 0.05em;
    }
    .draw-welcome__steps {
      display: flex;
      flex-direction: column;
      gap: 0.55rem;
      margin-bottom: 1.5rem;
      text-align: left;
    }
    .draw-welcome__steps span {
      font-size: 0.9rem;
      color: rgba(200, 175, 120, 0.8);
      background: rgba(185, 138, 50, 0.07);
      border-radius: 8px;
      padding: 0.35rem 0.7rem;
    }
    .draw-welcome__steps b { color: rgba(235, 200, 130, 0.95); }
    .draw-welcome__btn {
      padding: 0.65rem 2rem;
      border-radius: 24px;
      border: 1px solid rgba(185, 138, 50, 0.5);
      background: linear-gradient(135deg, rgba(185, 130, 35, 0.6), rgba(140, 90, 15, 0.6));
      color: #f5e4a0;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s, box-shadow 0.2s;
    }
    .draw-welcome__btn:hover {
      background: linear-gradient(135deg, rgba(210, 155, 45, 0.8), rgba(165, 110, 20, 0.8));
      box-shadow: 0 0 20px rgba(220, 175, 60, 0.3);
    }

    /* –ú–æ–±–∏–ª—å–Ω—ã–µ –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ */
    @media (max-width: 600px) {
      .draw-toolbar { border-radius: 20px; gap: 0.35rem; padding: 0.5rem 0.7rem; }
      .draw-color { width: 22px; height: 22px; }
      .draw-size__range { width: 50px; }
      .draw-btn { width: 32px; height: 32px; font-size: 0.88rem; }
    }
  </style>
</head>
<body class="draw-page">
  <div id="globe-container" class="globe-fixed"></div>
  <div id="atmosphere-widget" class="atmosphere-widget" aria-label="–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞—Ç–º–æ—Å—Ñ–µ—Ä—ã"></div>

  <header class="draw-header">
    <a href="index.html" class="draw-header__back" data-i18n="draw_back">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
    <span class="draw-header__title" data-i18n="draw_title">‚ú¶ –¢–≤–æ—Ä—á–µ—Å–∫–∞—è –∫–æ–º–Ω–∞—Ç–∞</span>
    <nav style="display:flex;gap:0.6rem;align-items:center;">
      <a href="relax.html" class="draw-header__back" data-i18n="draw_nav_relax">üåô –û—Ç–¥—ã—Ö</a>
      <a href="guardian.html" class="draw-header__back" data-i18n="draw_nav_guardian">–•—Ä–∞–Ω–∏—Ç–µ–ª—å ‚Üí</a>
    </nav>
  </header>

  <!-- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–∞—è –ø–æ–¥—Å–∫–∞–∑–∫–∞ ‚Äî –∏—Å—á–µ–∑–∞–µ—Ç –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∫–∞—Å–∞–Ω–∏–∏ -->
  <div class="draw-welcome" id="draw-welcome">
    <div class="draw-welcome__box">
      <p class="draw-welcome__title" data-i18n="draw_welcome_title">üé® –¢–≤–æ—Ä—á–µ—Å–∫–∞—è –∫–æ–º–Ω–∞—Ç–∞</p>
      <div class="draw-welcome__steps">
        <span data-i18n="draw_welcome_step1">üñå <b>–í—ã–±–µ—Ä–∏ —Ü–≤–µ—Ç</b> –≤–Ω–∏–∑—É</span>
        <span data-i18n="draw_welcome_step2">üìè <b>–†–∞–∑–º–µ—Ä –∫–∏—Å—Ç–∏</b> ‚Äî –ø–æ–ª–∑—É–Ω–æ–∫</span>
        <span data-i18n="draw_welcome_step3">‚úè <b>–†–∏—Å—É–π</b> –ø–æ –±–µ–ª–æ–º—É —Ö–æ–ª—Å—Ç—É</span>
        <span data-i18n="draw_welcome_step4">‚Ü© <b>Ctrl+Z</b> ‚Äî –æ—Ç–º–µ–Ω–∏—Ç—å</span>
        <span data-i18n="draw_welcome_step5">‚¨á <b>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</b> ‚Äî –∫–Ω–æ–ø–∫–∞ —Å–ø—Ä–∞–≤–∞</span>
      </div>
      <button class="draw-welcome__btn" id="draw-welcome-close" data-i18n="draw_welcome_btn">–ü–æ–Ω—è—Ç–Ω–æ, –Ω–∞—á–∏–Ω–∞—é!</button>
    </div>
  </div>

  <div class="draw-canvas-wrap">
    <canvas id="draw-canvas" width="900" height="600"></canvas>
  </div>

  <p class="draw-tool-hint" id="draw-hint" data-i18n="draw_hint">–≤—ã–±–µ—Ä–∏ —Ü–≤–µ—Ç –∏ —Ä–∏—Å—É–π!</p>

  <div class="draw-toolbar" id="draw-toolbar">
    <!-- –¶–≤–µ—Ç–∞ -->
    <div class="draw-colors" id="draw-colors">
      <div class="draw-color draw-color--active" data-color="#1a1a1a" style="background:#1a1a1a" title="–ß—ë—Ä–Ω—ã–π"></div>
      <div class="draw-color" data-color="#e8e0d6" style="background:#e8e0d6;border:1px solid #bbb" title="–ë–µ–ª—ã–π"></div>
      <div class="draw-color" data-color="#c44" style="background:#c44" title="–ö—Ä–∞—Å–Ω—ã–π"></div>
      <div class="draw-color" data-color="#e8a23a" style="background:#e8a23a" title="–û—Ä–∞–Ω–∂–µ–≤—ã–π"></div>
      <div class="draw-color" data-color="#e8c83a" style="background:#e8c83a" title="–ñ—ë–ª—Ç—ã–π"></div>
      <div class="draw-color" data-color="#4caf50" style="background:#4caf50" title="–ó–µ–ª—ë–Ω—ã–π"></div>
      <div class="draw-color" data-color="#2196f3" style="background:#2196f3" title="–°–∏–Ω–∏–π"></div>
      <div class="draw-color" data-color="#9c27b0" style="background:#9c27b0" title="–§–∏–æ–ª–µ—Ç–æ–≤—ã–π"></div>
      <div class="draw-color" data-color="#f48fb1" style="background:#f48fb1" title="–†–æ–∑–æ–≤—ã–π"></div>
      <div class="draw-color" data-color="#795548" style="background:#795548" title="–ö–æ—Ä–∏—á–Ω–µ–≤—ã–π"></div>
      <label class="draw-color-custom" title="–°–≤–æ–π —Ü–≤–µ—Ç">
        <input type="color" id="draw-color-picker" value="#1a1a1a" />
      </label>
    </div>

    <div class="draw-sep"></div>

    <!-- –†–∞–∑–º–µ—Ä –∫–∏—Å—Ç–∏ -->
    <div class="draw-size">
      <span class="draw-size__label">‚úè</span>
      <input type="range" class="draw-size__range" id="draw-size" min="1" max="60" value="5" />
    </div>

    <div class="draw-sep"></div>

    <!-- –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã -->
    <button class="draw-btn draw-btn--active" id="btn-brush" title="–ö–∏—Å—Ç—å" data-i18n="draw_brush" data-i18n-attr="title">üñå</button>
    <button class="draw-btn" id="btn-eraser" title="–õ–∞—Å—Ç–∏–∫" data-i18n="draw_eraser" data-i18n-attr="title">‚¨ú</button>
    <button class="draw-btn" id="btn-undo" title="–û—Ç–º–µ–Ω–∏—Ç—å (Ctrl+Z)" data-i18n="draw_undo" data-i18n-attr="title">‚Ü©</button>
    <button class="draw-btn draw-btn--danger" id="btn-clear" title="–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë" data-i18n="draw_clear" data-i18n-attr="title">üóë</button>

    <div class="draw-sep"></div>

    <button class="draw-btn draw-btn--save" id="btn-save" title="–°–∫–∞—á–∞—Ç—å —Ä–∏—Å—É–Ω–æ–∫" data-i18n="draw_save" data-i18n-attr="title">‚¨á</button>
  </div>

  <script src="i18n.js" defer></script>
  <script src="atmosphere.js" defer></script>
  <script>
  (function () {
    var canvas  = document.getElementById("draw-canvas");
    var ctx     = canvas.getContext("2d");
    var hint    = document.getElementById("draw-hint");

    /* ‚îÄ‚îÄ –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π —ç–∫—Ä–∞–Ω ‚îÄ‚îÄ */
    var welcome = document.getElementById("draw-welcome");
    var welcomeClose = document.getElementById("draw-welcome-close");
    /* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–π —Ä–∞–∑ */
    if (localStorage.getItem("draw_welcomed")) {
      welcome.classList.add("hidden");
      setTimeout(function () { welcome.style.display = "none"; }, 400);
    }
    function closeWelcome() {
      localStorage.setItem("draw_welcomed", "1");
      welcome.classList.add("hidden");
      setTimeout(function () { welcome.style.display = "none"; }, 400);
    }
    welcomeClose.addEventListener("click", closeWelcome);
    welcome.addEventListener("click", function (e) {
      if (e.target === welcome) closeWelcome();
    });

    var currentColor = "#1a1a1a";
    var currentSize  = 5;
    var isEraser     = false;
    var isDrawing    = false;
    var lastX = 0, lastY = 0;
    var undoStack    = [];
    var MAX_UNDO     = 25;

    /* ‚îÄ‚îÄ –†–∞–∑–º–µ—Ä —Ö–æ–ª—Å—Ç–∞ –ø–æ–¥ —ç–∫—Ä–∞–Ω ‚îÄ‚îÄ */
    function resizeCanvas() {
      var wrap = canvas.parentElement;
      var maxW = wrap.clientWidth  - 32;
      var maxH = wrap.clientHeight - 32;
      var ratio = 900 / 600;
      var w = Math.min(900, maxW);
      var h = w / ratio;
      if (h > maxH) { h = maxH; w = h * ratio; }
      /* –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ */
      var tmp = ctx.getImageData(0, 0, canvas.width, canvas.height);
      canvas.style.width  = Math.round(w) + "px";
      canvas.style.height = Math.round(h) + "px";
      /* –õ–æ–≥–∏—á–µ—Å–∫–∏–π —Ä–∞–∑–º–µ—Ä –Ω–µ –º–µ–Ω—è–µ–º —á—Ç–æ–±—ã –Ω–µ –ø–æ—Ç–µ—Ä—è—Ç—å —Ä–∏—Å—É–Ω–æ–∫ */
    }
    resizeCanvas();
    window.addEventListener("resize", resizeCanvas);

    /* ‚îÄ‚îÄ –•–æ–ª—Å—Ç ‚Äî –±–µ–ª—ã–π —Ñ–æ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚îÄ‚îÄ */
    ctx.fillStyle = "#fff";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    /* ‚îÄ‚îÄ –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Å —É—á—ë—Ç–æ–º –º–∞—Å—à—Ç–∞–±–∞ ‚îÄ‚îÄ */
    function getPos(e) {
      var rect = canvas.getBoundingClientRect();
      var scaleX = canvas.width  / rect.width;
      var scaleY = canvas.height / rect.height;
      var src = e.touches ? e.touches[0] : e;
      return {
        x: (src.clientX - rect.left) * scaleX,
        y: (src.clientY - rect.top)  * scaleY
      };
    }

    /* ‚îÄ‚îÄ Undo ‚îÄ‚îÄ */
    function saveUndo() {
      if (undoStack.length >= MAX_UNDO) undoStack.shift();
      undoStack.push(ctx.getImageData(0, 0, canvas.width, canvas.height));
    }

    function undo() {
      if (!undoStack.length) return;
      ctx.putImageData(undoStack.pop(), 0, 0);
    }

    /* ‚îÄ‚îÄ –†–∏—Å–æ–≤–∞–Ω–∏–µ ‚îÄ‚îÄ */
    function startDraw(e) {
      e.preventDefault();
      var pos = getPos(e);
      saveUndo();
      isDrawing = true;
      lastX = pos.x; lastY = pos.y;
      /* –¢–æ—á–∫–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ */
      ctx.beginPath();
      ctx.arc(lastX, lastY, currentSize / 2, 0, Math.PI * 2);
      ctx.fillStyle = isEraser ? "#fff" : currentColor;
      ctx.fill();
    }

    function draw(e) {
      e.preventDefault();
      if (!isDrawing) return;
      var pos = getPos(e);
      ctx.beginPath();
      ctx.moveTo(lastX, lastY);
      ctx.lineTo(pos.x, pos.y);
      ctx.strokeStyle = isEraser ? "#fff" : currentColor;
      ctx.lineWidth   = currentSize;
      ctx.lineCap     = "round";
      ctx.lineJoin    = "round";
      ctx.globalCompositeOperation = isEraser ? "destination-out" : "source-over";
      ctx.stroke();
      lastX = pos.x; lastY = pos.y;
    }

    function stopDraw() {
      if (isDrawing) ctx.globalCompositeOperation = "source-over";
      isDrawing = false;
    }

    canvas.addEventListener("mousedown",  startDraw);
    canvas.addEventListener("mousemove",  draw);
    canvas.addEventListener("mouseup",    stopDraw);
    canvas.addEventListener("mouseleave", stopDraw);
    canvas.addEventListener("touchstart", startDraw, { passive: false });
    canvas.addEventListener("touchmove",  draw,      { passive: false });
    canvas.addEventListener("touchend",   stopDraw);

    /* ‚îÄ‚îÄ –¶–≤–µ—Ç–∞ ‚îÄ‚îÄ */
    document.getElementById("draw-colors").addEventListener("click", function (e) {
      var el = e.target.closest(".draw-color");
      if (!el) return;
      document.querySelectorAll(".draw-color").forEach(function (c) { c.classList.remove("draw-color--active"); });
      el.classList.add("draw-color--active");
      currentColor = el.dataset.color;
      setTool("brush");
    });

    document.getElementById("draw-color-picker").addEventListener("input", function () {
      currentColor = this.value;
      document.querySelectorAll(".draw-color").forEach(function (c) { c.classList.remove("draw-color--active"); });
      setTool("brush");
    });

    /* ‚îÄ‚îÄ –†–∞–∑–º–µ—Ä ‚îÄ‚îÄ */
    document.getElementById("draw-size").addEventListener("input", function () {
      currentSize = parseInt(this.value, 10);
    });

    /* ‚îÄ‚îÄ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã ‚îÄ‚îÄ */
    function setTool(tool) {
      isEraser = (tool === "eraser");
      canvas.classList.toggle("eraser-mode", isEraser);
      document.getElementById("btn-brush").classList.toggle("draw-btn--active", !isEraser);
      document.getElementById("btn-eraser").classList.toggle("draw-btn--active", isEraser);
      hint.textContent = isEraser ? "–ª–∞—Å—Ç–∏–∫ ¬∑ —Å—Ç–∏—Ä–∞—é" : "–∫–∏—Å—Ç—å ¬∑ —Ä–∏—Å—É–π";
    }

    document.getElementById("btn-brush").addEventListener("click", function () { setTool("brush"); });
    document.getElementById("btn-eraser").addEventListener("click", function () { setTool("eraser"); });
    document.getElementById("btn-undo").addEventListener("click", undo);
    document.getElementById("btn-clear").addEventListener("click", function () {
      if (!confirm("–û—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å —Ö–æ–ª—Å—Ç?")) return;
      saveUndo();
      ctx.fillStyle = "#fff";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
    });

    document.getElementById("btn-save").addEventListener("click", function () {
      var link = document.createElement("a");
      link.download = "—Ä–∏—Å—É–Ω–æ–∫-–¥–∞—à–∏-" + Date.now() + ".png";
      link.href = canvas.toDataURL("image/png");
      link.click();
    });

    /* Ctrl+Z */
    document.addEventListener("keydown", function (e) {
      if ((e.ctrlKey || e.metaKey) && e.key === "z") { e.preventDefault(); undo(); }
    });

    /* ‚îÄ‚îÄ Globe / i18n ‚îÄ‚îÄ */
    function initI18n() {
      if (!window.I18n) return;
      var container = document.getElementById("globe-container");
      if (container) window.I18n.init(container);
    }
    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", initI18n);
    } else {
      initI18n();
    }
  })();
  </script>
</body>
</html>
